<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Page 4</title>
    <link rel="stylesheet" href="style.css" />

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID",
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      auth.onAuthStateChanged((user) => {
        if (!user) window.location.href = "login.html";
      });
    </script>
  </head>
  <body>
    <nav>
      <a href="index.html">Home</a>
      <a href="page1.html">Page 1</a>
      <a href="page2.html">Page 2</a>
      <a href="page3.html">Page 3</a>
      <a href="page4.html">Page 4</a>
      <a href="#" onclick="auth.signOut()">Sign Out</a>
    </nav>

    <h1>Page 4: Uploaded Files</h1>
    <div id="file-list"></div>

    <script>
      const pageNumber = "4";
      db.collection("files")
        .where("page", "==", pageNumber)
        .onSnapshot((snapshot) => {
          const container = document.getElementById("file-list");
          container.innerHTML = "";
          snapshot.docs.forEach((doc) => {
            const file = doc.data();
            let element = "";
            if (file.mimetype?.startsWith("image/")) {
              element = `<img src="${file.url}" alt="${file.name}">`;
            } else if (file.mimetype === "application/pdf") {
              element = `<embed src="${file.url}" type="application/pdf">`;
            } else {
              element = `<a href="${file.url}" target="_blank">${file.name}</a>`;
            }
            element += `<div style="margin-top:5px;">
                  <button onclick="updateStatus('${doc.id}','approved')">Approve</button>
                  <button onclick="updateStatus('${doc.id}','revise')">Revise</button>
                </div>`;
            const div = document.createElement("div");
            div.innerHTML = element;
            container.appendChild(div);
          });
        });

      function updateStatus(fileId, status) {
        db.collection("files").doc(fileId).update({ status });
      }
    </script>
  </body>
</html>
