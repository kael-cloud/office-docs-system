<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Home</title>
    <link rel="stylesheet" href="style.css" />

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCLxo3xwV9HHLHNBJ3OOwGH9TNUlOcd810",
        authDomain: "docssystem-53344.firebaseapp.com",
        projectId: "docssystem-53344",
        storageBucket: "docssystem-53344.appspot.com",
        messagingSenderId: "148150761173",
        appId: "1:148150761173:web:6bcb198c8754ec3fbd145c",
        measurementId: "G-NEYY09HB5P",
      };

      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
      const storage = firebase.storage();
    </script>
  </head>
  <body>
    <nav>
      <a href="index.html">Home</a>
      <a href="page1.html">Process 1</a>
      <a href="page2.html">Process 2</a>
      <a href="page3.html">Approved</a>
      <a href="page4.html">Revisions</a>
      <a href="#" onclick="auth.signOut()">Sign Out</a>
    </nav>

    <h1>Welcome to the Docs System</h1>
    <form id="uploadForm">
      <input type="file" id="fileInput" required />
      <select id="pageSelect" required>
        <option value="1">Process 1</option>
        <option value="2">Process 2</option>
      </select>
      <button type="submit">Upload</button>
    </form>

    <script>
      auth.onAuthStateChanged((user) => {
        if (!user) window.location.href = "login.html";
      });

      document
        .getElementById("uploadForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const file = document.getElementById("fileInput").files[0];
          const page = document.getElementById("pageSelect").value;
          const user = auth.currentUser;

          const storageRef = storage.ref(`uploads/${Date.now()}_${file.name}`);
          const snapshot = await storageRef.put(file);
          const url = await snapshot.ref.getDownloadURL();

          await db.collection("files").add({
            name: file.name,
            url,
            status: "pending",
            uploadedBy: user.uid,
            page,
          });

          alert("File uploaded!");
        });
    </script>
  </body>
</html>
